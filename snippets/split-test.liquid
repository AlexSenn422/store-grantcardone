{% comment %}
Split Test by Zyber
https://apps.shopify.com/splittest

Author:     Zac Bruce
Email:      z.bruce@zyber.co.nz / zac@tuft.co.nz
Support:    https://www.zyber.io/app-support

Files:
snippets/split-test.liquid

snippets/split-test.liquid
    The logic engine behind Split Test.
    This file is changed with each new version released.

Knowledgebase:
http://docs.zyber.io/split-test
{% endcomment %}
{% if load_tracking == true %}<script type="text/javascript">
var zst_settings={{shop.metafields.zst.settings}}, _paq = _paq || [], zstg = zstg || {}, storageKey = '__zyber_split_test_group';
function NoGroupReturned(r){this.name="NoGroupReturned",this.message=r||"No Group Returned",this.stack=(new Error).stack}function BadGroupError(r){this.name="BadGroupError",this.message=r||"Bad Group Returned",this.stack=(new Error).stack}function OutOfRangeError(r){this.name="OutOfRangeError",this.message=r||"Not returned within range",this.stack=(new Error).stack}NoGroupReturned.prototype=Object.create(Error.prototype),NoGroupReturned.prototype.constructor=NoGroupReturned,BadGroupError.prototype=Object.create(Error.prototype),BadGroupError.prototype.constructor=BadGroupError,OutOfRangeError.prototype=Object.create(Error.prototype),OutOfRangeError.prototype.constructor=OutOfRangeError;
function storageAvailable(){try{var e=window.localStorage,r="__storage_test__";return e.setItem(r,r),e.removeItem(r),!0}catch(t){return!1}}function isFunction(e){return Function.prototype.isPrototypeOf(e)}function generateGroup(){return Math.random()}function getCookie(e){function r(e){return e.replace(/([.*+?\^${}()|\[\]\/\\])/g,"\\$1")}var t=document.cookie.match(RegExp("(?:^|;\\s*)"+r(e)+"=([^;]*)"));return t?t[1]:null}function storeGroup(e){storageAvailable()?(localStorage.setItem(storageKey,e),document.cookie=storageKey+"="+e+"; expires=Fri, 31 Dec 2100 23:59:59 GMT; path=/;"):document.cookie=storageKey+"="+e+"; expires=Fri, 31 Dec 2100 23:59:59 GMT; path=/;"}function getGroupValue(){var e="";if(e=storageAvailable()?localStorage.getItem(storageKey):getCookie(storageKey)){if(isNaN(e))throw new BadGroupError;return e}throw new NoGroupReturned}function getGroup(e){if(void 0===zstg.group){var r;try{r=getGroupValue()}catch(t){if(!(t instanceof NoGroupReturned||t instanceof BadGroupError))throw new Error("Unmatched Exception.");r=generateGroup(),storeGroup(r)}zstg.group=r}try{return calculateGroup(zstg.group,e)}catch(t){return t instanceof OutOfRangeError?calculateGroup(zstg.group,function(e){return e<=.5?"a":"b"}):"a"}}function calculateGroup(e,r){if(isFunction(r))return r(e);switch(r){case 4:return e<=.25?"a":e<=.5?"b":e<=.75?"c":"d";case 3:return e<=.33?"a":e<=.66?"b":"c";case 2:return e<=.5?"a":"b";default:throw new OutOfRangeError}}function matchesGroup(e,r){return null!==e&&e===getGroup(r)}getWorker=function(e){return"string"==typeof e&&(e=document.getElementById(e)),null==e?null:"SCRIPT"==e.nodeName?getWorker(e.parentElement):e};
{% if template.name == 'product' %} {% for collection in product.collections limit:5 %} {% if forloop.last %} {% assign product_collections = product_collections | append: '|' | append: collection.title | split: '|' %} {% else %} {% assign product_collections = product_collections | append: '|' | append: collection.title %} {% endif %} {% endfor %} {% for product_collection in product_collections %} {% if forloop.length > 1 %} {% if forloop.first %} {% if product_collection != '' %} {% assign product_array = '["' | append: product_collection | append: '",' %} {% else %} {% assign product_array = '[' %} {% endif %} {% elsif forloop.last %} {% assign product_array = product_array | append: '"' | append: product_collection | append: '"]' %} {% else %} {% assign product_array = product_array | append: '"' | append: product_collection | append: '",' %} {% endif %} {% else %} {% assign product_array = '"' | append: product_collection | append: '"' %} {% endif %} {% endfor %} {% if product.metafields.z-split-test.random_id %} {% assign zst_rand_id = product.metafields.z-split-test.random_id %} {% else %} {% assign zst_rand_id = '' %} {% endif %} _paq.push(['setEcommerceView', '{{ zst_rand_id }}_{{ product.id }}', '{{ product.title }}', {{ product_array }}, '{{ product.price | money_without_currency }}']);
function getQueryVariable(e){for(var r=window.location.search.substring(1),t=r.split("&"),o=0;o<t.length;o++){var u=t[o].split("=");if(decodeURIComponent(u[0])==e)return decodeURIComponent(u[1])}return!1}function hasDebugMode(){return getQueryVariable("{{product.id}}debug")}if(!hasDebugMode()){var productMeta={{product.metafields.z-split-test | json}};if(!matchesGroup(productMeta.group,productMeta.odds)){var groupLabel=getGroup(productMeta.group_type);window.location.replace("{{shop.url}}/products/"+JSON.parse(productMeta.urls)[groupLabel])}}
{% endif %}
_paq.push(["trackPageView"]),function(){var e="//a.zyberlabs.co.nz/";_paq.push(["setTrackerUrl",e+"piwik.php"]),_paq.push(["setSiteId",zst_settings.piwik_id]);var t=document,a=t.createElement("script"),s=t.getElementsByTagName("script")[0];a.type="text/javascript",a.async=!0,a.defer=!0,a.src=e+"piwik.js",s.parentNode.insertBefore(a,s)}();
</script>{% assign zst_tracking_loaded = true %}{% endif %}
{% if template.name != 'product' %} {% assign splitTestArraySize = product.metafields.z-split-test | size %} {% if splitTestArraySize > 0 %} {% if product.metafields.z-split-test.random_id %} {% assign zst_rand_id = product.metafields.z-split-test.random_id %} {% else %} {% assign zst_rand_id = '' %} {% endif %} {% if product.metafields.z-split-test.odds %} {% assign group_share = product.metafields.z-split-test.odds %} {% else %} {% assign group_share = product.metafields.z-split-test.group_type %} {% endif %}<script type="text/javascript" id="stw-{{product.id}}">
!function(){var t=getWorker("stw-{{product.id}}"),e={{product.metafields.z-split-test | json}};if(null!==t)matchesGroup(e.group,{{group_share}})?_paq.push(["trackContentImpression","SplitTest","{{zst_rand_id}}_{{ product.id }}","{{ product.url }}"]):t.parentNode.removeChild(t);else{var r=document.getElementById("stw-{{product.id}}");r.parentNode.removeChild(r)}}();
</script>{% endif %}{% endif %}